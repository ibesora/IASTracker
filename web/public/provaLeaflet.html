<!DOCTYPE html>
<html lang="en">
<head>
         <meta http-equiv="content-type" content="text/html; charset=utf-8">
         <meta name="viewport" content="width=device-width, initial-scale=1.0">
         <meta name="author" content="Institut Cartogràfic i Geològic de Catalunya -ICGC"/>
         <meta name="description" content="Exemple llibreria Leaflet amb geoserveis ICGC">
         <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />

          <style>
             html, body, .map {
             margin: 0;
             padding: 0;
             width: 100%;
             height: 90%;
             }         
          </style>
          
          <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
          <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
          <script src="./leaflet-plugins-1.3.0/layer/tile/Bing.js"></script>
          <script src="./leaflet-plugins-1.3.0/layer/tile/Google.js"></script>
          <script src="http://rawgithub.com/kartena/Proj4Leaflet/master/lib/proj4-compressed.js" type="text/javascript"></script>
          <script src="https://rawgithub.com/kartena/Proj4Leaflet/master/src/proj4leaflet.js" type="text/javascript"></script>

          <script src="//code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/bootstrap/css/bootstrap.min.css">
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/css/font-awesome/css/font-awesome.min.css">
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/css/map-icons/css/map-icons.css">
          <link media="all" type="text/css" rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:400,600,300">
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/css/docs.min.css">
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/css/templates.css">
          <link media="all" type="text/css" rel="stylesheet" href="http://www.bergaactiva.cat/css/turisme.css">

          <script src="http://www.bergaactiva.cat/js/plugins/bootstrap/js/bootstrap.min.js"></script>
          <title>IASTracker</title>
</head>
    <body>
      <div class="collapse navbar-collapse" style="padding: 0;">
        <ul class="nav navbar-nav">
          <li id="navbar-loguejat">
            <a href="http://127.0.0.1/IASTracker/usuaris/ibesora">
              <img src="http://www.bergaactiva.cat/images/thumbs/usuaris/ibesora.PNG" class="navbar-user-img" pull-left="pull-left" id="imgPerfilBarra" alt="ibesora">ibesora
            </a>
            <div id="stats-usuari" class="arrow_box menu_box hidden">
              <div style="padding: 10px;">
                <div style="padding: 10px; border-bottom: 1px solid #EEE; margin-bottom: 10px;">
                  <h4>Observacions validades<span class="pull-right">80%</span></h4>
                  <h4>Observacions pendents de validar<span class="pull-right">3</span></h4>
                </div>
                <div>
                  <ul class="nav nav-pills nav-stacked">
                    <li><a href="http://127.0.0.1/IASTracker/usuaris/ibesora/configuracio">Configuració</a></li>
                    <li><a href="http://127.0.0.1/IASTracker/logout">Tancar sessió</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </li>
          <li id="navbar-adm">
            <a href="http://127.0.0.1/IASTracker/adm/"><i class="fa fa-lock"></i>Administració</a>
          </li>
        </ul>
      </div>
      <div id="map" class="map"></div>
       	<div id="data"></div>
            <script type="text/javascript">

            	function computeLayers(e)
            	{

            		var z = map.getZoom();
            		var bounds = map.getBounds();
            		var layerSW = L.latLng(40.48456, 0.02884);
            		var layerNE = L.latLng(42.91822, 3.46619);
            		var layerBounds = L.latLngBounds(layerSW, layerNE);
            		var contains = bounds.contains(layerBounds);
            		var intersects = bounds.intersects(layerBounds);

            		if((z >= 5 && z <= 18) && intersects)
            		{

            			control.addOverlay(serveiTopoCache, "Topogràfic ICC");
            			control.addOverlay(serveitopoGrisCache, "Topogràfic gris ICC");
            			control.addOverlay(serveiOrtoCache, "Ortofoto ICC");

            		}
            		else
            		{

            			control.removeLayer(serveiTopoCache);
            			control.removeLayer(serveitopoGrisCache);
            			control.removeLayer(serveiOrtoCache);

            		}

            		$('#data').html('Bounds: ' + bounds.toBBoxString() + ' Zoom: ' + z + ' Contains: ' + contains + ' Intersects: ' + intersects);

            	}

            	function onClick(e)
            	{

            		var z = map.getZoom();
            		var bounds = map.getBounds();
            		$('#data').html('Bounds: ' + bounds.toBBoxString() + ' Zoom: ' + z + ' Click on: ' + e.latlng.toString());

            	}

                 var center = [41.82045, 1.54907];
                 var crs25831 = new L.Proj.CRS('EPSG:25831','+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs',
                          {
                               resolutions: [1100, 550, 275, 100, 50, 25, 10, 5, 2, 1, 0.5, 0.25]
                          }
                 );

                 var serveiTopoCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", {
                        layers: 'topo',
                        format: 'image/png',
                        transparent: true,
                        crs: crs25831,
                        continuousWorld: true,
                        attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC',
                        zIndex: 3
                  });

                 var serveiOrtoCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", {
                        layers: 'orto',
                        format: 'image/png',
                        transparent:true,
                        crs: crs25831,
                        continuousWorld: true,
                        attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC',
                        zIndex: 2
                  });

                  var serveitopoGrisCache = L.tileLayer.wms("http://mapcache.icc.cat/map/bases/service?", {
                        layers: 'topogris',
                        format: 'image/png',
                        transparent: true,
                        crs: crs25831,
                        continuousWorld: true,
                        attribution: 'Institut Cartogràfic i Geològic de Catalunya -ICGC',
                        zIndex: 4
                  });

                  var openStreetMaps = L.tileLayer("http://otile{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png", 
                  {
    				attribution: '&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',
    				subdomains: "1234",
    				zIndex: 1
    				});

                  var googleMapsRoadmap = L.Google('ROADMAP');
                  var googleMapsSatellite = L.Google('SATELLITE');
                  var googleMapsHybrid = L.Google('HYBRID');
                  var googleMapsTerrain = L.Google('TERRAIN');
                  var bing = L.BingLayer();

                  var osmOrtoICC = L.layerGroup([openStreetMaps, serveiOrtoCache]);
                  var osmTopoICC = L.layerGroup([serveiTopoCache, openStreetMaps]);
                  var osmTopoGrisICC = L.layerGroup([openStreetMaps, serveitopoGrisCache]);
                  var map = L.map('map', {
                        layers: openStreetMaps,
                        continuousWorld: true,
                        worldCopyJump: false,
                        center: center,
                        zoom: 2,
                        });

                        var baseMaps = {
                        				"OSM": openStreetMaps,
                         	       /* "Topogràfic": serveiTopoCache,
                                     "Topogràfic gris": serveitopoGrisCache,
                                     "Ortofoto": serveiOrtoCache,
                                     "GM Roadmap": googleMapsRoadmap,
                                     "GM Satellite": googleMapsSatellite,
                                     "GM Hybrid": googleMapsHybrid,
                                     "GM Terrain": googleMapsTerrain*/
                        };
                        var overlayMaps = {
                                     
                        };
                       var control = L.control.layers(baseMaps, overlayMaps, {collapsed: false,
                       	autoZIndex: false}).addTo(map);
                       map.on('moveend', computeLayers);
                       map.on('zoomend', computeLayers);
                       map.on('click', onClick);
              </script>
    </body>
</html>